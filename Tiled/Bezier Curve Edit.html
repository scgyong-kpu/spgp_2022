<!DOCTYPE html>
<!-- saved from url=(0059)https://math.hws.edu/eck/cs424/notes2013/canvas/bezier.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Bezier Curve Edit</title>
<script type="text/javascript">

"use strict";

var cubicCanvas, quadCanvas;
var cubicGraphics, quadGraphics;
var cubicPoints, quadPoints;
var quadHideSelect, cubicHideSelect;
var lockSelect;

var mapImg;

function Point2D(x,y) {
    this.x = x;
    this.y = y;
}

function cubicDraw() {
    var i;
    cubicGraphics.fillStyle = "white";
    cubicGraphics.fillRect(0,0,1000,650);
    cubicGraphics.drawImage(mapImg, 100, 100, 800, 450);
    //console.log(mapImg);
    if ( ! cubicHideSelect.checked ) {
        cubicGraphics.lineWidth = 1;
        if (lockSelect.checked) {
            cubicGraphics.strokeStyle = "#880000";   
        }
        else {
            cubicGraphics.strokeStyle = "#888888";
        }
        for (i = 0; i < cubicPoints.length - 1; i++) {
            if (i % 3 != 1) {
                cubicGraphics.beginPath();
                cubicGraphics.moveTo( cubicPoints[i].x + .5, cubicPoints[i].y + .5 );
                cubicGraphics.lineTo( cubicPoints[i+1].x + .5, cubicPoints[i+1].y + .5 );
                cubicGraphics.stroke();
            }
        }
        for (i = 0; i < cubicPoints.length; i++) {
            if ( i % 3 == 0 ) {
                cubicGraphics.fillStyle="black";
                disk(cubicGraphics, cubicPoints[i].x, cubicPoints[i].y, 5);
            }
            else {
                cubicGraphics.fillStyle= "blue";
                cubicGraphics.fillRect(cubicPoints[i].x - 5, cubicPoints[i].y - 5, 10, 10);
                
            }
        }
    }
    cubicGraphics.beginPath();
    cubicGraphics.moveTo(cubicPoints[0].x,cubicPoints[0].y);
    for (i = 1; i < cubicPoints.length; i += 3) {
        cubicGraphics.bezierCurveTo(cubicPoints[i].x,cubicPoints[i].y,
                              cubicPoints[i+1].x,cubicPoints[i+1].y,
                              cubicPoints[i+2].x,cubicPoints[i+2].y);
    }
    cubicGraphics.lineWidth = 2;
    cubicGraphics.strokeStyle = "black";
    cubicGraphics.stroke();
}

function quadDraw() {
    var i;
    quadGraphics.fillStyle = "white";
    quadGraphics.fillRect(0,0,600,600);
    if ( ! quadHideSelect.checked ) {
        quadGraphics.lineWidth = 1;
        quadGraphics.strokeStyle = "#888888";
        for (i = 0; i < 10; i++) {
                quadGraphics.beginPath();
                quadGraphics.moveTo( quadPoints[i].x + .5, quadPoints[i].y + .5 );
                quadGraphics.lineTo( quadPoints[i+1].x + .5, quadPoints[i+1].y + .5 );
                quadGraphics.stroke();
        }
        for (i = 0; i < 11; i++) {
            if ( i % 2 == 0 ) {
                quadGraphics.fillStyle="black";
                disk(quadGraphics, quadPoints[i].x, quadPoints[i].y, 5);
            }
            else {
                quadGraphics.fillStyle= "blue";
                quadGraphics.fillRect(quadPoints[i].x - 5, quadPoints[i].y - 5, 10, 10);
                
            }
        }
    }
    quadGraphics.beginPath();
    quadGraphics.moveTo(quadPoints[0].x,quadPoints[0].y);
    for (i = 1; i < 11; i += 2) {
        quadGraphics.quadraticCurveTo(quadPoints[i].x,quadPoints[i].y,
                              quadPoints[i+1].x,quadPoints[i+1].y);
    }
    quadGraphics.lineWidth = 2;
    quadGraphics.strokeStyle = "black";
    quadGraphics.stroke();
}

function disk( graphics, x, y, radius ) {
    graphics.beginPath();
    graphics.arc(x,y,radius,0,Math.PI*2);
    graphics.fill();
    
}

function doLock() {
    if ( lockSelect.checked ) {
        cubicPoints[4].x = 2*cubicPoints[3].x - cubicPoints[2].x;
        cubicPoints[4].y = 2*cubicPoints[3].y - cubicPoints[2].y;
        cubicPoints[7].x = 2*cubicPoints[6].x - cubicPoints[5].x;
        cubicPoints[7].y = 2*cubicPoints[6].y - cubicPoints[5].y;
    }
    cubicDraw();
}


var draggingCubic = false;
var draggingQuad = false;
var dragPointIndex;

function doMouseUp(evt) {
    draggingCubic = false;
    draggingQuad = false;
}

function doCubicMouseDown(evt) {
    if (draggingCubic || draggingQuad || cubicHideSelect.checked) {
        return;
    }
    var r = cubicCanvas.getBoundingClientRect();
    var x = Math.round(evt.clientX - r.left);
    var y = Math.round(evt.clientY - r.top);
    for (var i = cubicPoints.length - 1; i >= 0; i--) {
        var p = cubicPoints[i];
        if (Math.abs(p.x - x) <= 5 && Math.abs(p.y - y) <= 5) {
            draggingCubic = true;
            dragPointIndex = i;
            return;
        }
    }
}

function doCubicMouseMove(evt) {
    if (!draggingCubic) {
        return;
    }
    var r = cubicCanvas.getBoundingClientRect();
    var x = Math.round(evt.clientX - r.left);
    var y = Math.round(evt.clientY - r.top);
    var offsetX = x - cubicPoints[dragPointIndex].x;
    var offsetY = y - cubicPoints[dragPointIndex].y;
    cubicPoints[dragPointIndex].x = x;
    cubicPoints[dragPointIndex].y = y;
    if ( dragPointIndex % 3 == 0) {
        if (dragPointIndex > 0) {
            cubicPoints[dragPointIndex - 1].x += offsetX;
            cubicPoints[dragPointIndex - 1].y += offsetY;
        }
        if (dragPointIndex < cubicPoints.length - 1) {
            cubicPoints[dragPointIndex + 1].x += offsetX;
            cubicPoints[dragPointIndex + 1].y += offsetY;
        }
    }
    else if (lockSelect.checked) {
        if (dragPointIndex == 2) {
            cubicPoints[4].x = 2*cubicPoints[3].x - cubicPoints[2].x;
            cubicPoints[4].y = 2*cubicPoints[3].y - cubicPoints[2].y;
        }
        else if (dragPointIndex == 4) {
           cubicPoints[2].x = 2*cubicPoints[3].x - cubicPoints[4].x;
           cubicPoints[2].y = 2*cubicPoints[3].y - cubicPoints[4].y;
        }
        else if (dragPointIndex == 5) {
            cubicPoints[7].x = 2*cubicPoints[6].x - cubicPoints[5].x;
            cubicPoints[7].y = 2*cubicPoints[6].y - cubicPoints[5].y;
        }
        else if (dragPointIndex == 7) {
            cubicPoints[5].x = 2*cubicPoints[6].x - cubicPoints[7].x;
            cubicPoints[5].y = 2*cubicPoints[6].y - cubicPoints[7].y;
        }
    }
    cubicDraw();
}

function doQuadMouseDown(evt) {
    if (draggingCubic || draggingQuad || quadHideSelect.checked) {
        return;
    }
    var r = quadCanvas.getBoundingClientRect();
    var x = Math.round(evt.clientX - r.left);
    var y = Math.round(evt.clientY - r.top);
    for (var i = 10; i >= 0; i--) {
        var p = quadPoints[i];
        if (Math.abs(p.x - x) <= 5 && Math.abs(p.y - y) <= 5) {
            draggingQuad = true;
            dragPointIndex = i;
            return;
        }
    }
}

function doQuadMouseMove(evt) {
    if (!draggingQuad) {
        return;
    }
    var r = quadCanvas.getBoundingClientRect();
    var x = Math.round(evt.clientX - r.left);
    var y = Math.round(evt.clientY - r.top);
    quadPoints[dragPointIndex].x = x;
    quadPoints[dragPointIndex].y = y;
    quadDraw();
}

function init() {
    try {
        cubicCanvas = document.getElementById("cubic");
        quadCanvas = document.getElementById("quad");
        cubicGraphics = cubicCanvas.getContext("2d");
        quadGraphics = quadCanvas.getContext("2d");
    }
    catch (e) {
        var message = document.getElementById("message");
        message.innerHTML = "Oops... Sorry, your browser doesn't support the canvas element.";
        return;
    }
    lockSelect = document.getElementById("lock");
    lockSelect.checked = false;
    lockSelect.onclick = doLock;
    quadHideSelect = document.getElementById("quadHide");
    quadHideSelect.checked = false;
    quadHideSelect.onclick = function() { quadDraw(); };
    cubicHideSelect = document.getElementById("cubicHide");
    cubicHideSelect.checked = false;
    cubicHideSelect.onclick = function() { cubicDraw(); };
    cubicPoints = [
        // new Point2D(50,350),  new Point2D(150,450),
        // new Point2D(150,100), new Point2D(200,100), new Point2D(250,100),
        // new Point2D(325,300), new Point2D(325,400), new Point2D(425,400),
        // new Point2D(475,100), new Point2D(550,175)

      {"x":92,"y":528},{"x":194,"y":518},{"x":191,"y":443},
      {"x":191,"y":395},{"x":187,"y":323},{"x":123,"y":326},
      {"x":126,"y":252},{"x":128,"y":188},{"x":176,"y":127},
      {"x":263,"y":127},{"x":348,"y":125},{"x":401,"y":199},
      {"x":402,"y":268},{"x":401,"y":339},{"x":302,"y":427},
      {"x":414,"y":496},{"x":462,"y":532},{"x":554,"y":536},
      {"x":615,"y":497},{"x":717,"y":409},{"x":600,"y":322},
      {"x":601,"y":260},{"x":597,"y":195},{"x":649,"y":115},
      {"x":731,"y":115},{"x":820,"y":113},{"x":871,"y":196},
      {"x":873,"y":256},{"x":872,"y":330},{"x":804,"y":361},
      {"x":806,"y":410},{"x":802,"y":462},{"x":822,"y":514},
      {"x":907,"y":519}
    ]
     // [{"x":92,"y":528},{"x":194,"y":518},{"x":191,"y":443},{"x":191,"y":395},{"x":187,"y":323},{"x":123,"y":326},{"x":126,"y":252},{"x":128,"y":188},{"x":176,"y":127},{"x":263,"y":127},{"x":348,"y":125},{"x":401,"y":199},{"x":402,"y":268},{"x":401,"y":339},{"x":302,"y":427},{"x":414,"y":496},{"x":462,"y":532},{"x":554,"y":536},{"x":615,"y":497},{"x":717,"y":409},{"x":600,"y":322},{"x":601,"y":260},{"x":597,"y":195},{"x":649,"y":115},{"x":731,"y":115},{"x":820,"y":113},{"x":871,"y":196},{"x":873,"y":256},{"x":872,"y":330},{"x":804,"y":361},{"x":806,"y":410},{"x":802,"y":462},{"x":822,"y":514},{"x":907,"y":519}]
    // [
    //     new Point2D(50,350),  new Point2D(150,450),
    //     new Point2D(150,100), new Point2D(200,100), new Point2D(250,100),
    //     new Point2D(325,300), new Point2D(325,400), new Point2D(425,400),
    //     new Point2D(475,100), new Point2D(550,175)
    // ];
    quadPoints = [
        new Point2D(50,300), new Point2D(100,50),  
        new Point2D(200,100), new Point2D(300,75),  
        new Point2D(250,150), new Point2D(220,450),  
        new Point2D(350,400), new Point2D(325,470),  
        new Point2D(500,500), new Point2D(475,400),  
        new Point2D(550,300), 
    ];
    mapImg = new Image();
    mapImg.src = "map.png"
    cubicDraw();
    quadDraw();
    document.addEventListener("mouseup", doMouseUp, false);
    cubicCanvas.addEventListener("mousedown", doCubicMouseDown, false);
    cubicCanvas.addEventListener("mousemove", doCubicMouseMove, false);
    quadCanvas.addEventListener("mousedown", doQuadMouseDown, false);
    quadCanvas.addEventListener("mousemove", doQuadMouseMove, false);
};
function printPoints() {
  let str = "[\n  ";
  for (let i = 0; i < cubicPoints.length; i++) {
    str += JSON.stringify(cubicPoints[i]);
    if (i < cubicPoints.length - 1) str += ",";
    if (i % 3 == 2) str += "\n  ";
  }
  str += "\n]";
  document.getElementById("out").value = str;
}
function printJava() {
  const pts = cubicPoints.map((p)=>{ return { x:p.x-100, y:p.y-100}; });
  let str = "Path path = new Path();\n";
  str += `path.moveTo(${pts[0].x}, ${pts[0].y});\n`;
  for (let i = 1; i < cubicPoints.length; i += 3) {
    str += `path.cubicTo(${pts[i].x}, ${pts[i].y}, ${pts[i+1].x}, ${pts[i+1].y}, ${pts[i+2].x}, ${pts[i+2].y});\n`;
  }
  document.getElementById("out").value = str;
}
</script>
</head>
<body onload="init()" style="background-color: #CCC">

<noscript><p style="color:red">Sorry, this page requires JavaScript to run.</p></noscript>

<!--[if lt IE 9]>
<hr>
<p style="color:red">Sorry, this page uses HTML canvas.<br>
Canvas is not supported in Internet Explorer 8 or earlier.<br>
Please use a newer version or a different browser.</p>
<hr>
<![endif]-->

   
<h1>Bezier Curve Demos</h1>

<p id="message" style="font-weight: bold"></p>

<img src="map.png" style="display:none;" />
    
<h2 style="margin-top: 1cm">Cubic Bezier Curve</h2>

<p style="width:630px">This demo shows a path made up of three cubic Bezier curve
segments.  Each segment is defined by its two endpoints and two control points.
A control point determines the tangent at the corresponding endpoint.  You can
drag the endpoints and the control points.  If "Lock Control Point Pairs" is
specified, then the two control points associated with the endpoint where two
segments join are constrained to move together, resulting in a smooth curve.
</p>

<p style="font-weight: bold"><input type="checkbox" id="lock"> <label for="lock" style="margin-right:1cm">Lock Control Point Pairs</label>
<input type="checkbox" id="cubicHide"> <label for="cubicHide">Hide Controls</label></p>

<canvas width="1000" height="650" id="cubic" style="background-color: white; border: thin solid black"></canvas>
<br />
<button onclick="printPoints()">Points</button>
<button onclick="printJava()">Java</button>
<br />
<textarea id="out" cols="80" rows="10"></textarea>

<!--
<h2 style="margin-top: 1cm">Quadratic Bezier Curve</h2>

<p style="width:630px">This demo shows a path made up of five quadratic Bezier curve
segments.  Each segment is defined by its two endpoints and one control point.  The
control point determines the tangent at both endpoints.  You can drag the
control points and endpoints.
</p>
-->

<p style="display:none;"><input type="checkbox" id="quadHide"> <label for="quadHide">Hide Controls</label></p>

<canvas width="0" height="0" id="quad" style="background-color: white; border: thin solid black"></canvas>




</body></html>